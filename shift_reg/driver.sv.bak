`include "transaction.sv"

class driver; 
transaction tr;
mailbox gen2driv;
virtual shiftreg_intf vif;
function new(mailbox gen2driv,virtual shiftreg_intf vif, event next);
this.gen2driv=gen2driv;
this.vif=vif;
this.next = next;
endfunction
task run();
  // --- Sabse pehle Reset ko Release karein ---
  vif.rst_n <= 1'b0; // Pehle reset dabayein
  repeat(2) @(posedge vif.clk);
  vif.rst_n <= 1'b1; // Ab reset release kar dein taake RTL chal sake
  $display("[DRV] Reset Released at %0t", $time);

  forever begin
    gen2driv.get(tr);
    @(posedge vif.clk);
    // Ab baki signals bhejain
    vif.shift_en <= tr.shift_en;
    vif.dir      <= tr.dir;
    vif.din      <= tr.din;
    
    // Note: Yahan vif.rst_n ko tr.rst_n se bar bar update na karein 
    // jab tak aap generator se random reset na bhej rahe hon.
    
    @(posedge vif.clk);
    ->next;
  end
endtask
endclass 