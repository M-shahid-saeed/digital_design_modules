`include "generator.sv"
`include "driver.sv"
`include "monitor.sv"
`include "scoreboard.sv"

// 1. Class level par parameter N add kiya
class environment #(parameter N = 8);
  
  // 2. Tamam internal classes ko #(N) ke saath declare kiya
  generator  #(N) gen;
  driver     #(N) driv;
  monitor    #(N) mon;
  scoreboard #(N) scb;
  
  mailbox gen2driv;
  mailbox mon2scb;
  event gen_done; 
  
  // 3. Virtual interface ko bhi bataya ke wo N-bit ki hai
  virtual multiplier_intf #(N) vif;
  
  function new(virtual multiplier_intf #(N) vif);
    this.vif = vif;
    gen2driv = new();
    mon2scb  = new();
    
    // 4. Objects create karte waqt parameter pass karna lazmi hai
    gen  = new(gen2driv, gen_done); 
    driv = new(gen2driv, vif);
    mon  = new(vif, mon2scb);
    scb  = new(mon2scb);
  endfunction
  
  task run();
    $display("[ENV] Simulation Started with N=%0d at %0t", N, $time);
    fork
      gen.run();  
      driv.run(); 
      mon.run();  
      scb.run();  
    join_any 
    
    // Latency handling: Pipeline ke aakhri results ka intezar
    repeat(10) @(posedge vif.clk); 
    
    $display("[ENV] Simulation Finished at %0t", $time);
    $finish; 
  endtask
endclass